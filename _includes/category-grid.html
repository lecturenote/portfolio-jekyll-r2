{% assign items = site.projects | where: "category", include.category | sort: 'order' %}
<div class="grid cards">
  {% for p in items %}
    <a class="card" href="{{ p.url | relative_url }}">
      {%- assign thumb = nil -%}

      {%- if p.thumbnail -%}
        {%- assign thumb = p.thumbnail -%}
      {%- endif -%}

      {%- if thumb == nil and p.thumbnail_file and site.r2_base -%}
        {%- capture thumb -%}{{ site.r2_base }}/{{ p.thumbnail_file | uri_escape }}{%- endcapture -%}
      {%- endif -%}

      {%- if thumb == nil and p.cover -%}
        {%- assign thumb = p.cover -%}
      {%- endif -%}

      {%- if thumb == nil and p.cover_file and site.r2_base -%}
        {%- capture thumb -%}{{ site.r2_base }}/{{ p.cover_file | uri_escape }}{%- endcapture -%}
      {%- endif -%}

      {%- if thumb == nil and p.gallery and p.gallery.size > 0 -%}
        {%- assign g = p.gallery[0] -%}
        {%- assign fc = g | slice: 0, 1 -%}
        {%- if g contains '://' or fc == '/' -%}
          {%- assign thumb = g -%}
        {%- elsif site.r2_base -%}
          {%- capture thumb -%}{{ site.r2_base }}/{{ g | uri_escape }}{%- endcapture -%}
        {%- endif -%}
      {%- endif -%}

      {%- if thumb == nil and p.gallery_files and p.gallery_files.size > 0 and site.r2_base -%}
        {%- capture thumb -%}{{ site.r2_base }}/{{ p.gallery_files[0] | uri_escape }}{%- endcapture -%}
      {%- endif -%}

      {% if thumb %}<img src="{{ thumb }}" alt="{{ p.title }}" loading="lazy">{% endif %}
      <div class="card-body">
        <h3>{{ p.title }}</h3>
        {% if p.summary %}<p>{{ p.summary }}</p>{% endif %}
      </div>
    </a>
  {% endfor %}
</div>
