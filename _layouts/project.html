---
layout: default
---
{% assign r2 = site.r2_base | default: '' %}

<article class="project">
  <header class="project-header">
    <h1>{{ page.title }}</h1>
    <ul class="meta">
      {% if page.category %}<li class="pill">{{ page.category | capitalize }}</li>{% endif %}
      {% if page.role %}<li>{{ page.role }}</li>{% endif %}
      {% if page.year %}<li>{{ page.year }}</li>{% endif %}
    </ul>

    {%- assign cover_url = nil -%}
    {% if page.cover %}{% assign cover_url = page.cover %}{% endif %}
    {% if cover_url == nil and page.cover_file and r2 != '' %}
      {% capture cover_url %}{{ r2 }}/{{ page.cover_file | uri_escape }}{% endcapture %}
    {% endif %}
    {% if cover_url %}
      <img class="cover" src="{{ cover_url }}" alt="{{ page.title }} cover">
    {% endif %}
  </header>

  <section class="project-body">
    {{ content }}
  </section>

  {% assign imgs = page.gallery_files | default: page.gallery %}
  {% if imgs %}
  <section class="project-gallery">
    {% for item in imgs %}
      {% assign url = item %}
      {% if url %}
        {% assign firstchar = url | slice: 0, 1 %}
        {% if url contains '://' or firstchar == '/' %}
          {# absolute or path; keep as-is #}
        {% elsif r2 != '' %}
          {% capture url %}{{ r2 }}/{{ item | uri_escape }}{% endcapture %}
        {% endif %}
      {% endif %}
      <a class="lb" href="{{ url }}"><img src="{{ url }}" loading="lazy" alt=""></a>
    {% endfor %}
  </section>
  {% endif %}

  {% if page.youtube_id %}
    <section class="project-video">
      <div class="video-embed">
        <iframe
          src="https://www.youtube.com/embed/{{ page.youtube_id }}"
          title="YouTube video" frameborder="0"
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
          allowfullscreen></iframe>
      </div>
    </section>
  {% else %}
    {% assign poster_url = nil %}
    {% if page.poster %}{% assign poster_url = page.poster %}{% endif %}
    {% if poster_url == nil and page.poster_file and r2 != '' %}
      {% capture poster_url %}{{ r2 }}/{{ page.poster_file | uri_escape }}{% endcapture %}
    {% endif %}

    {% assign video_url = nil %}
    {% if page.video %}{% assign video_url = page.video %}{% endif %}
    {% if video_url == nil and page.video_file and r2 != '' %}
      {% capture video_url %}{{ r2 }}/{{ page.video_file | uri_escape }}{% endcapture %}
    {% endif %}

    {% if video_url %}
    <section class="project-video">
      <video controls preload="metadata"{% if poster_url %} poster="{{ poster_url }}"{% endif %}>
        <source src="{{ video_url }}" type="video/mp4">
      </video>
    </section>
    {% endif %}
  {% endif %}
</article>
