---
layout: default
---
{% assign r2 = site.r2_base | default: '' %}

<article class="project">
  {% if page.summary %}
  <section class="project-body"><p>{{ page.summary }}</p></section>
  {% endif %}

  {% assign imgs = page.gallery_files | default: page.gallery %}
  {% if imgs and imgs.size > 0 %}
  <section class="project-gallery">
    {% for item in imgs %}
      {% assign url = item %}
      {% assign first = url | slice: 0, 1 %}
      {% unless url contains '://' or first == '/' %}
        {% if r2 != '' %}{% capture url %}{{ r2 }}/{{ item | uri_escape }}{% endcapture %}{% endif %}
      {% endunless %}

      {% assign id = forloop.index | prepend: 'img-' %}
      <a class="thumb" href="#{{ id }}"><img src="{{ url }}" loading="lazy" alt=""></a>
      <div class="lightbox" id="{{ id }}">
        <a class="close" href="#" aria-label="Close"></a>
        {% if forloop.index0 > 0 %}<a class="nav prev" href="#img-{{ forloop.index0 }}"></a>{% endif %}
        {% if forloop.index < imgs.size %}<a class="nav next" href="#img-{{ forloop.index | plus: 1 }}"></a>{% endif %}
        <img src="{{ url }}" alt="">
      </div>
    {% endfor %}
  </section>
  {% endif %}

  {% assign poster_url = nil %}
  {% if page.poster %}{% assign poster_url = page.poster %}{% endif %}
  {% if poster_url == nil and page.poster_file and r2 != '' %}
    {% capture poster_url %}{{ r2 }}/{{ page.poster_file | uri_escape }}{% endcapture %}
  {% endif %}

  {% assign video_url = nil %}
  {% if page.video %}{% assign video_url = page.video %}{% endif %}
  {% if video_url == nil and page.video_file and r2 != '' %}
    {% capture video_url %}{{ r2 }}/{{ page.video_file | uri_escape }}{% endcapture %}
  {% endif %}

  {% if video_url %}
  <section class="project-video">
    <video controls preload="metadata"{% if poster_url %} poster="{{ poster_url }}"{% endif %}>
      <source src="{{ video_url }}" type="video/mp4">
    </video>
  </section>
  {% endif %}
</article>
